<!-- d2101771-498d-4562-a036-847b8df83727 1092aa71-3509-4368-966e-240b94cf634d -->
# –ü–ª–∞–Ω D-Sprint-1: Build & Publish

## 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ GitHub Actions

### devops/doc/guides/github-actions-intro.md

–°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, –≤–∫–ª—é—á–∞—é—â—É—é:

- –ß—Ç–æ —Ç–∞–∫–æ–µ GitHub Actions –∏ workflow
- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏: jobs, steps, matrix strategy
- –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å Pull Requests –∏ triggers
- –°–æ–±—ã—Ç–∏—è: `push`, `pull_request`, `workflow_dispatch`
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤: public vs private –≤ ghcr.io
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ `GITHUB_TOKEN`

### devops/doc/guides/ghcr-setup.md

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ GitHub Container Registry:

- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ghcr.io
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤ (public/private)
- –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –æ–±—Ä–∞–∑—ã –ø—É–±–ª–∏—á–Ω—ã–º–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ permissions

## 2. –°–æ–∑–¥–∞–Ω–∏–µ GitHub Actions Workflow

### .github/workflows/build.yml

–°–æ–∑–¥–∞—Ç—å workflow —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

**Triggers:**

- `push` –Ω–∞ –≤–µ—Ç–∫—É `main`
- `pull_request` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–±–æ—Ä–∫–∏

**Matrix Strategy:**

- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ 3 –æ–±—Ä–∞–∑–æ–≤: `bot`, `api`, `frontend`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–∑–∞: –∏–º—è, dockerfile, context

**Steps:**

1. Checkout –∫–æ–¥–∞
2. Docker meta - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤ (latest + SHA)
3. Setup Docker Buildx
4. Login to ghcr.io —á–µ—Ä–µ–∑ `GITHUB_TOKEN`
5. Build and push —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º layers
6. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤ –≤ ghcr.io

**–í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `docker/build-push-action@v5`
- –í–∫–ª—é—á–∏—Ç—å cache-from/cache-to –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- –¢–µ–≥–∏: `latest` –∏ `sha-{SHORT_SHA}`
- –û–±—Ä–∞–∑—ã: `ghcr.io/${{ github.repository_owner }}/homeguru-{service}:tag`

## 3. –°–æ–∑–¥–∞–Ω–∏–µ docker-compose.prod.yml

### docker-compose.prod.yml

–í–µ—Ä—Å–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏–∑ registry:

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ docker-compose.yml:**

- –í–º–µ—Å—Ç–æ `build:` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `image: ghcr.io/...`
- –û—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ (networks, volumes, env, healthchecks)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥ `latest` –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

- –¢–µ –∂–µ —Å–∞–º—ã–µ env_file –∏ environment —Å–µ–∫—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ —Ç–æ–º, —á—Ç–æ –Ω—É–∂–µ–Ω `.env` —Ñ–∞–π–ª

## 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### README.md

**–î–æ–±–∞–≤–∏—Ç—å badge —Å—Ç–∞—Ç—É—Å–∞ —Å–±–æ—Ä–∫–∏:**

```markdown
[![Build Docker Images](https://github.com/{owner}/{repo}/actions/workflows/build.yml/badge.svg)](https://github.com/{owner}/{repo}/actions/workflows/build.yml)
```

**–°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ü–∏—é "üê≥ Docker –æ–±—Ä–∞–∑—ã":**

- –°–ø–∏—Å–æ–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –≤ ghcr.io
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ pull –æ–±—Ä–∞–∑–æ–≤: `docker pull ghcr.io/...`
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ docker-compose.prod.yml
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É local build –∏ registry images

**–û–±–Ω–æ–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker":**

- –î–æ–±–∞–≤–∏—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: Local Build –∏ Production Images
- –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è local: `docker compose up --build`
- –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è prod: `docker compose -f docker-compose.prod.yml up`

### devops/doc/plans/d1-build-publish-plan.md

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–Ω –∫–∞–∫ —Ñ–∞–π–ª –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.

### devops/doc/reports/d1-testing-report.md

–®–∞–±–ª–æ–Ω –¥–ª—è –æ—Ç—á–µ—Ç–∞ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:

- Checklist –ø—Ä–æ–≤–µ—Ä–æ–∫
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ pull –æ–±—Ä–∞–∑–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ docker-compose.prod.yml
- –°—Ç–∞—Ç—É—Å CI workflow

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –≤ CI:

**5.1 Pull –æ–±—Ä–∞–∑–æ–≤ –∏–∑ registry:**

```bash
docker pull ghcr.io/{owner}/homeguru-bot:latest
docker pull ghcr.io/{owner}/homeguru-api:latest
docker pull ghcr.io/{owner}/homeguru-frontend:latest
```

**5.2 –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose.prod.yml:**

```bash
docker compose -f docker-compose.prod.yml up
```

**5.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤:**

- PostgreSQL: –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "ready"
- API: http://localhost:8000/docs –¥–æ—Å—Ç—É–ø–µ–Ω
- Frontend: http://localhost:3000 –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- Bot: –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "polling started"

**5.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ CI:**

- Push –≤ main –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å workflow
- Pull Request –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–±–æ—Ä–∫—É –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- –û–±—Ä–∞–∑—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Packages —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

## 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—Ä–∞–∑–∞–º

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ GitHub:

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Packages —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–∑–∞ (bot, api, frontend):

   - Settings ‚Üí Danger Zone
   - Change visibility ‚Üí Public
   - Confirm

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ devops-roadmap.md

–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–ø—Ä–∏–Ω—Ç–æ–≤:

- D-Sprint-1 —Å—Ç–∞—Ç—É—Å: ‚úÖ Completed
- –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–ª–∞–Ω: `[üìã D-Sprint-1 Plan](plans/d1-build-publish-plan.md)`
- –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –¥–∞—Ç–æ–π –∏ –≤–µ—Ä—Å–∏–µ–π

### To-dos

- [ ] –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ GitHub Actions –∏ GHCR (2 —Ñ–∞–π–ª–∞ –≤ devops/doc/guides/)
- [ ] –°–æ–∑–¥–∞—Ç—å .github/workflows/build.yml —Å matrix strategy –¥–ª—è 3 –æ–±—Ä–∞–∑–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å docker-compose.prod.yml –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏–∑ registry
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README.md: –¥–æ–±–∞–≤–∏—Ç—å badge, —Å–µ–∫—Ü–∏—é Docker –æ–±—Ä–∞–∑–æ–≤, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–∞ –∏ —à–∞–±–ª–æ–Ω –æ—Ç—á–µ—Ç–∞ –≤ devops/doc/
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å workflow: push –≤ –≤–µ—Ç–∫—É, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—é
- [ ] –°–¥–µ–ª–∞—Ç—å –æ–±—Ä–∞–∑—ã –ø—É–±–ª–∏—á–Ω—ã–º–∏ –≤ GitHub Packages
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å pull –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ docker-compose.prod.yml
- [ ] –û–±–Ω–æ–≤–∏—Ç—å devops-roadmap.md: —Å—Ç–∞—Ç—É—Å —Å–ø—Ä–∏–Ω—Ç–∞, –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π