---
alwaysApply: true
---

# Workflow: TDD Development Process

> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è code-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —á–µ—Ä–µ–∑ TDD —Å–æ–≥–ª–∞—Å–Ω–æ [vision.md](vision.md), [tasklist.md](tasklist.md) –∏ [qa_conventions.mdc](qa_conventions.mdc)

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **Test-Driven Development** - —Ç–µ—Å—Ç—ã –ø–∏—à—É—Ç—Å—è –ü–ï–†–ï–î —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
2. **Red ‚Üí Green ‚Üí Refactor** - —Å—Ç—Ä–æ–≥–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ü–∏–∫–ª—É TDD
3. **–°–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–π ‚Üí TDD —Ü–∏–∫–ª ‚Üí –ü—Ä–æ–≤–µ—Ä—è–π –∫–∞—á–µ—Å—Ç–≤–æ ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π**
4. **–û–±–Ω–æ–≤–ª—è–π –ø—Ä–æ–≥—Ä–µ—Å—Å** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
5. **–°–ª–µ–¥—É–π conventions** –∏–∑ [conventions.md](conventions.md) –∏ [qa_conventions.mdc](qa_conventions.mdc)

---

## –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ (TDD)

### 1Ô∏è‚É£ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Design + Test Plan)

**–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏—Ç–µ—Ä–∞—Ü–∏–∏:**
- [ ] –ü—Ä–æ—á–∏—Ç–∞–π –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏–∑ [tasklist.md](tasklist.md)
- [ ] –ü—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ:
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (Protocol)
  - –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º–∏ (type hints)
  - **–ü–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤** - –∫–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –Ω–∞–ø–∏—Å–∞–Ω—ã
- [ ] –ü–æ–∫–∞–∂–∏ –ø—Ä–∏–º–µ—Ä—ã:
  - –ö–æ–¥-–ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Å–∫–µ–ª–µ—Ç)
  - –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤ (–Ω–∞–∑–≤–∞–Ω–∏—è, —Å—Ü–µ–Ω–∞—Ä–∏–∏)
- [ ] **–î–æ–∂–¥–∏—Å—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è** –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ (scope)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –∏ –∫–∞–∫ –±—É–¥–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è
- ‚úÖ Type hints –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤

‚ùó **–ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∞!**

---

### 2Ô∏è‚É£ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ TDD (Red-Green-Refactor)

**TDD —Ü–∏–∫–ª - –ø–æ–≤—Ç–æ—Ä—è–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:**

#### üî¥ RED: –ù–∞–ø–∏—à–∏ –ø–∞–¥–∞—é—â–∏–π —Ç–µ—Å—Ç

**–®–∞–≥ 1: –¢–µ—Å—Ç –ü–ï–†–ï–î –∫–æ–¥–æ–º**
- [ ] –ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- [ ] –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º
- [ ] –°–ª–µ–¥—É–π naming: `test_<action>_<scenario>`
- [ ] –ò—Å–ø–æ–ª—å–∑—É–π AAA –ø–∞—Ç—Ç–µ—Ä–Ω (Arrange-Act-Assert)
- [ ] –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

**–ü—Ä–∏–º–µ—Ä RED:**
```python
# tests/test_dialogue_manager.py
def test_add_message():
    """–¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é"""
    # Arrange
    dm = DialogueManager(max_history=20)
    
    # Act
    dm.add_message(123, "user", "Hello")
    
    # Assert
    history = dm.get_history(123)
    assert len(history) == 1
    assert history[0]["role"] == "user"
    assert history[0]["content"] == "Hello"
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:**
```bash
pytest tests/test_dialogue_manager.py::test_add_message -v
# Expected: FAILED - –º–µ—Ç–æ–¥ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
```

---

#### üü¢ GREEN: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–®–∞–≥ 2: –ú–∏–Ω–∏–º—É–º –∫–æ–¥–∞ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞**
- [ ] –†–µ–∞–ª–∏–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- [ ] –ù–µ –¥–æ–±–∞–≤–ª—è–π –ª–∏—à–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- [ ] –ù–µ —É—Å–ª–æ–∂–Ω—è–π —Ä–µ—à–µ–Ω–∏–µ
- [ ] –°–ª–µ–¥—É–π KISS –ø—Ä–∏–Ω—Ü–∏–ø—É

**–ü—Ä–∏–º–µ—Ä GREEN:**
```python
# src/bot/dialogue_manager.py
from typing import Protocol

class DialogueManager:
    def __init__(self, max_history: int) -> None:
        self.max_history = max_history
        self.dialogues: dict[int, list[dict[str, str]]] = {}
    
    def add_message(self, user_id: int, role: str, content: str) -> None:
        if user_id not in self.dialogues:
            self.dialogues[user_id] = []
        
        self.dialogues[user_id].append({
            "role": role,
            "content": content
        })
    
    def get_history(self, user_id: int) -> list[dict[str, str]]:
        return self.dialogues.get(user_id, [])
```

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:**
```bash
pytest tests/test_dialogue_manager.py::test_add_message -v
# Expected: PASSED ‚úÖ
```

---

#### üîµ REFACTOR: –£–ª—É—á—à–∏ –∫–æ–¥

**–®–∞–≥ 3: –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è**
- [ ] –£–ª—É—á—à–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –£–±–µ—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (DRY)
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (–µ—Å–ª–∏ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- [ ] **–¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∑–µ–ª–µ–Ω—ã–º–∏**

**–ü—Ä–∏–º–µ—Ä REFACTOR:**
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ max_history
def add_message(self, user_id: int, role: str, content: str) -> None:
    if user_id not in self.dialogues:
        self.dialogues[user_id] = []
    
    self.dialogues[user_id].append({
        "role": role,
        "content": content
    })
    
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
    if len(self.dialogues[user_id]) > self.max_history:
        self.dialogues[user_id] = self.dialogues[user_id][-self.max_history:]
```

**–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:**
```bash
pytest tests/test_dialogue_manager.py -v
# Expected: All PASSED ‚úÖ
```

---

#### üîÅ –ü–æ–≤—Ç–æ—Ä–∏ —Ü–∏–∫–ª –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

**–î–æ–±–∞–≤—å —Ç–µ—Å—Ç—ã –¥–ª—è edge cases –∏ –æ—à–∏–±–æ–∫:**
- [ ] Edge case: –ø—É—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è
- [ ] Edge case: –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ max_history
- [ ] Edge case: None –∑–Ω–∞—á–µ–Ω–∏—è
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏–∑–æ–ª—è—Ü–∏—è)

**–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ç–µ—Å—Ç = –Ω–æ–≤—ã–π RED-GREEN-REFACTOR —Ü–∏–∫–ª**

---

### 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è TDD —Ü–∏–∫–ª–æ–≤:**

**–ó–∞–ø—É—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make format

# –õ–∏–Ω—Ç–∏–Ω–≥
make lint

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
make typecheck

# –í—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test

# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
make quality
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- ‚úÖ `make format` - OK
- ‚úÖ `make lint` - 0 critical errors
- ‚úÖ `make typecheck` - Success (mypy strict, 0 errors)
- ‚úÖ `make test` - All passed
- ‚úÖ Coverage ‚â• 80%
- ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç [conventions.md](conventions.md)
- ‚úÖ –¢–µ—Å—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç [qa_conventions.mdc](qa_conventions.mdc)

‚ùó **–ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏!**

---

### 4Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- [ ] –û—Ç–º–µ—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã –≤ [tasklist.md](tasklist.md)
- [ ] –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –∏—Ç–µ—Ä–∞—Ü–∏–∏ (üöß In Progress ‚Üí ‚úÖ Done)
- [ ] –ü—Ä–æ—Å—Ç–∞–≤—å –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [ ] –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π –º–µ—Ç—Ä–∏–∫–∏:
  - Coverage: ___%
  - Tests: __/__ passed
  - Mypy: Success
  - Ruff: 0 errors
- [ ] –ù–∞–ø–æ–º–Ω–∏ –æ —Ä—É—á–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–∫—Ä–∏—Ç–µ—Ä–∏–π –∏–∑ –∏—Ç–µ—Ä–∞—Ü–∏–∏)
- [ ] **–î–æ–∂–¥–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

‚ùó **–ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –∫–æ–º–º–∏—Ç—É –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!**

---

### 5Ô∏è‚É£ –ö–æ–º–º–∏—Ç

**–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:**
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤—å –∫–æ–º–∞–Ω–¥—É git commit
- [ ] –§–æ—Ä–º–∞—Ç: `feat: <–æ–ø–∏—Å–∞–Ω–∏–µ>` –∏–ª–∏ `test: <—á—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ>`
- [ ] –ü—Ä–∏–º–µ—Ä—ã:
  - `feat: add dialogue manager with history limit`
  - `test: add dialogue manager tests with 85% coverage`
- [ ] **–î–æ–∂–¥–∏—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è** –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

---

### 6Ô∏è‚É£ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

**–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:**
- [ ] –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ (‚è≥ Pending ‚Üí üöß In Progress)
- [ ] –°–ø—Ä–æ—Å–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞: **"–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ N+1?"**
- [ ] –î–æ–∂–¥–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] –ù–∞—á–Ω–∏ —Å —à–∞–≥–∞ 1Ô∏è‚É£ (–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –®–∞–±–ª–æ–Ω TDD —Ä–∞–±–æ—Ç—ã

```
1. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
   "–ü—Ä–µ–¥–ª–∞–≥–∞—é —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ N:
    
    –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
    - –ö–ª–∞—Å—Å DialogueManager —Å –º–µ—Ç–æ–¥–∞–º–∏ add_message, get_history, clear_history
    - Protocol DialogueStorage –¥–ª—è DIP
    
    [–∫–æ–¥-–ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã]
    
    –ü–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤:
    - test_add_message (happy path)
    - test_get_history_empty (edge case)
    - test_max_history_limit (boundary)
    - test_multiple_users (isolation)
    
    –°–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ–º?"

2. TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
   
   üî¥ RED:
   [—Å–æ–∑–¥–∞–Ω–∏–µ test_dialogue_manager.py]
   [–Ω–∞–ø–∏—Å–∞–Ω–∏–µ test_add_message]
   $ pytest tests/test_dialogue_manager.py::test_add_message
   ‚ùå FAILED - DialogueManager not implemented
   
   üü¢ GREEN:
   [—Å–æ–∑–¥–∞–Ω–∏–µ dialogue_manager.py]
   [–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è add_message]
   $ pytest tests/test_dialogue_manager.py::test_add_message
   ‚úÖ PASSED
   
   üîµ REFACTOR:
   [—É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ max_history –ª–æ–≥–∏–∫–∏]
   $ pytest tests/test_dialogue_manager.py
   ‚úÖ All PASSED
   
   [–ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è test_get_history_empty, test_max_history_limit...]

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
   $ make quality
   ‚úÖ Format: OK
   ‚úÖ Lint: 0 errors
   ‚úÖ Typecheck: Success (0 errors)
   ‚úÖ Tests: 6/6 passed
   ‚úÖ Coverage: 85%
   
   –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
   ‚úÖ conventions.md - KISS, type hints, 1 –∫–ª–∞—Å—Å = 1 —Ñ–∞–π–ª
   ‚úÖ qa_conventions.mdc - AAA, –º–æ–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   [–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ tasklist.md]
   "–ò—Ç–µ—Ä–∞—Ü–∏—è N –∑–∞–≤–µ—Ä—à–µ–Ω–∞.
    
    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
    - Coverage: 85%
    - Tests: 6/6 passed
    - Mypy: Success
    - Ruff: 0 errors
    
    –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é: [–∫—Ä–∏—Ç–µ—Ä–∏–π —Ç–µ—Å—Ç–∞]"

5. –ö–æ–º–º–∏—Ç
   "–ü—Ä–µ–¥–ª–∞–≥–∞—é –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å:
    git commit -m 'feat: add dialogue manager with history limit and 85% test coverage'"

6. –ü–µ—Ä–µ—Ö–æ–¥
   "–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏ N+1?"
```

---

## TDD –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

### –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–Ω—è—Ç–Ω–∞?  
‚úÖ Type hints –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã?  
‚úÖ –ü–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω?  
‚úÖ Scope –æ–ø—Ä–µ–¥–µ–ª–µ–Ω?  

### TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚úÖ –¢–µ—Å—Ç –Ω–∞–ø–∏—Å–∞–Ω –ü–ï–†–ï–î –∫–æ–¥–æ–º?  
‚úÖ –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç (RED)?  
‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (GREEN)?  
‚úÖ –ö–æ–¥ —É–ª—É—á—à–µ–Ω (REFACTOR)?  
‚úÖ Edge cases –ø–æ–∫—Ä—ã—Ç—ã?  
‚úÖ –¢–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã?  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
‚úÖ `make format` - OK?  
‚úÖ `make lint` - 0 errors?  
‚úÖ `make typecheck` - Success?  
‚úÖ `make test` - All passed?  
‚úÖ Coverage ‚â• 80%?  
‚úÖ conventions.md —Å–æ–±–ª—é–¥–µ–Ω—ã?  
‚úÖ qa_conventions.mdc —Å–æ–±–ª—é–¥–µ–Ω—ã?  

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ tasklist.md –æ–±–Ω–æ–≤–ª–µ–Ω?  
‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã?  
‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ?  

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª?  
‚úÖ –ö–æ–º–º–∏—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω?  
‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–¥–æ–±—Ä–µ–Ω?  

---

## TDD Best Practices

### –†–∞–∑–º–µ—Ä TDD —Ü–∏–∫–ª–æ–≤
- **–ú–∞–ª–µ–Ω—å–∫–∏–µ —Ü–∏–∫–ª—ã** - 1 —Ç–µ—Å—Ç = 1 —Ü–∏–∫–ª
- **–û–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞ —Ä–∞–∑** - –Ω–µ —Å–º–µ—à–∏–≤–∞–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **–ë—ã—Å—Ç—Ä—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏** - —Ü–∏–∫–ª RED-GREEN-REFACTOR < 10 –º–∏–Ω—É—Ç

### –ü–æ—Ä—è–¥–æ–∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
1. **Happy path** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–Ω–∞—á–∞–ª–∞
2. **Edge cases** - –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
3. **Error handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. **Integration** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –ß—Ç–æ –ø–∏—Å–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö
‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ edge cases (–≥—Ä–∞–Ω–∏—Ü—ã, None, –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–≥–¥–µ –µ—Å—Ç—å try-except)
‚ùå –ì–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã –±–µ–∑ –ª–æ–≥–∏–∫–∏
‚ùå –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–∞–ø—Ä—è–º—É—é
‚ùå Implementation details

### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∞–≤–∏–ª–∞
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏ **—Ç–æ–ª—å–∫–æ** –∫–æ–≥–¥–∞ —Ç–µ—Å—Ç—ã –∑–µ–ª–µ–Ω—ã–µ
- –ó–∞–ø—É—Å–∫–∞–π —Ç–µ—Å—Ç—ã **–ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ** –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ï—Å–ª–∏ —Ç–µ—Å—Ç –∫—Ä–∞—Å–Ω—ã–π - –Ω–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏, –∏—Å–ø—Ä–∞–≤—å —Å–Ω–∞—á–∞–ª–∞

---

## –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å –≤ TDD

‚ùå –ù–µ –ø–∏—à–∏ –∫–æ–¥ –¥–æ —Ç–µ—Å—Ç–∞ (–Ω–∞—Ä—É—à–µ–Ω–∏–µ TDD)  
‚ùå –ù–µ –ø–∏—à–∏ –º–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤ —Å—Ä–∞–∑—É (–¥–µ–ª–∞–π —Ü–∏–∫–ª—ã)  
‚ùå –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π REFACTOR (–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ tech debt)  
‚ùå –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π –∫—Ä–∞—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã  
‚ùå –ù–µ –º–æ–∫–∏—Ä—É–π —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥  
‚ùå –ù–µ —Ç–µ—Å—Ç–∏—Ä—É–π implementation details  
‚ùå –ù–µ –¥–µ–ª–∞–π mega-—Ç–µ—Å—Ç—ã —Å 10+ assertions  
‚ùå –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∏—á–µ —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏  
‚ùå –ù–µ –Ω–∞—á–∏–Ω–∞–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∞  
‚ùå –ù–µ –∫–æ–º–º–∏—Ç—å –∫–æ–¥ –±–µ–∑ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è `make quality`  

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º workflow

**–í—ã–±–æ—Ä workflow:**
- **TDD workflow** (—ç—Ç–æ—Ç) - –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- **Tech Debt workflow** - –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
- **–û–±—ã—á–Ω—ã–π workflow** - –¥–ª—è trivial –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∫–æ–Ω—Ñ–∏–≥, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

**TDD –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è:**
- –ù–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤ —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
- –ù–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Å –ª–æ–≥–∏–∫–æ–π (–Ω–µ –≥–µ—Ç—Ç–µ—Ä—ã)
- –ö—Ä–∏—Ç–∏—á–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏—Å—Ç–æ—Ä–∏—è)
- –ê–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**TDD –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–ª—è:**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ (Config)
- –ü—Ä–æ—Å—Ç—ã—Ö –æ–±—ë—Ä—Ç–æ–∫ –±–µ–∑ –ª–æ–≥–∏–∫–∏
- UI/–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ (Telegram handlers)

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (—Ü–µ–ª–∏)

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å TDD |
|---|---|
| Test Coverage | ‚â• 80% (—Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–π –∫–æ–¥) |
| Tests Pass Rate | 100% (–≤—Å–µ–≥–¥–∞ –∑–µ–ª–µ–Ω—ã–µ) |
| Mypy Strict | 0 errors |
| Ruff Critical | 0 errors |
| Test Speed | < 1 —Å–µ–∫ –Ω–∞ unit —Ç–µ—Å—Ç |
| TDD Cycle Time | < 10 –º–∏–Ω—É—Ç RED-GREEN-REFACTOR |

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è TDD —Ü–∏–∫–ª–∞

```bash
# RED - –∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_module.py::test_function -v

# GREEN - –∑–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è —Ç–µ—Å—Ç–æ–≤
pytest tests/test_module.py

# REFACTOR - –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest tests/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
make quality

# Coverage –æ—Ç—á–µ—Ç
pytest --cov=src --cov-report=term-missing
pytest --cov=src --cov-report=html  # HTML –æ—Ç—á–µ—Ç

# –ë—ã—Å—Ç—Ä—ã–π —Ü–∏–∫–ª
pytest tests/test_module.py -v --tb=short
```

---

**–ü–æ–º–Ω–∏**: 
1. **–¢–µ—Å—Ç –ü–ï–†–ï–î –∫–æ–¥–æ–º** - —ç—Ç–æ –∑–∞–∫–æ–Ω TDD
2. **–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏** - –æ–¥–∏–Ω —Ü–∏–∫–ª = –æ–¥–∏–Ω —Ç–µ—Å—Ç
3. **–í—Å–µ–≥–¥–∞ –∑–µ–ª–µ–Ω—ã–µ —Ç–µ—Å—Ç—ã** - –Ω–µ –∫–æ–º–º–∏—Ç—å –∫—Ä–∞—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã
4. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - —É–ª—É—á—à–∞–π –∫–æ–¥ –ø–æ—Å–ª–µ GREEN
5. **–ö–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏** - `make quality` –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-11
