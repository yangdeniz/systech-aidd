# Tasklist: –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

| –ò—Ç–µ—Ä–∞—Ü–∏—è | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ |
|----------|--------|--------|------|
| 1 | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ + –≠—Ö–æ-–±–æ—Ç | ‚úÖ Done | 2025-10-10 |
| 2 | LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚úÖ Done | 2025-10-10 |
| 3 | –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–∏–∞–ª–æ–≥–æ–≤ | ‚úÖ Done | 2025-10-10 |
| 4 | –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ | ‚úÖ Done | 2025-10-10 |
| 5 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ Done | 2025-10-10 |
| 6 | –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç HomeGuru | ‚úÖ Done | 2025-10-11 |
| 7 | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π | ‚úÖ Done | 2025-10-11 |
| 8 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ | ‚è≥ Pending | - |
| 9 | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ LangSmith | ‚è≥ Pending | - |

**–õ–µ–≥–µ–Ω–¥–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:**
- ‚è≥ Pending - –Ω–µ –Ω–∞—á–∞—Ç–æ
- üöß In Progress - –≤ —Ä–∞–±–æ—Ç–µ
- ‚úÖ Done - –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- ‚ùå Blocked - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω

### –ò—Ç–µ—Ä–∞—Ü–∏—è 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è + –≠—Ö–æ-–±–æ—Ç
**–¶–µ–ª—å:** –†–∞–±–æ—á–∏–π —ç—Ö–æ-–±–æ—Ç –≤ Telegram

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- [x] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (`src/bot/`, `tests/`)
- [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç —Å `uv` (—Å–æ–∑–¥–∞—Ç—å `pyproject.toml`)
- [x] –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `aiogram`, `openai`, `python-dotenv`, `pytest`
- [x] –°–æ–∑–¥–∞—Ç—å `.env.example` —Å —à–∞–±–ª–æ–Ω–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [x] –°–æ–∑–¥–∞—Ç—å `.gitignore` (`.env`, `bot.log`, `__pycache__`, `.venv`)
- [x] –°–æ–∑–¥–∞—Ç—å `Makefile` —Å –±–∞–∑–æ–≤—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- [x] –°–æ–∑–¥–∞—Ç—å `src/bot/config.py` —Å –∫–ª–∞—Å—Å–æ–º `Config`
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ `.env` —á–µ—Ä–µ–∑ `python-dotenv`
- [x] –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π `.env` —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

**–≠—Ö–æ-–±–æ—Ç:**
- [x] –°–æ–∑–¥–∞—Ç—å `src/bot/bot.py` —Å –∫–ª–∞—Å—Å–æ–º `TelegramBot`
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å aiogram –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API (polling)
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - —ç—Ö–æ
- [x] –°–æ–∑–¥–∞—Ç—å `src/bot/main.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –ø–æ–ª—É—á–∏—Ç—å —ç—Ö–æ

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 2: LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
**–¶–µ–ª—å:** –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ OpenRouter

- [x] –°–æ–∑–¥–∞—Ç—å `src/bot/llm_client.py` —Å –∫–ª–∞—Å—Å–æ–º `LLMClient`
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `openai` client —Å `base_url` –Ω–∞ OpenRouter
- [x] –ú–µ—Ç–æ–¥ `get_response(messages)` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ system prompt –≤ –Ω–∞—á–∞–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞: –≤–º–µ—Å—Ç–æ —ç—Ö–æ - –æ—Ç–≤–µ—Ç –æ—Ç LLM

**–¢–µ—Å—Ç:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É - –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç LLM (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏)

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 3: –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–∏–∞–ª–æ–≥–æ–≤
**–¶–µ–ª—å:** –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞

- [x] –°–æ–∑–¥–∞—Ç—å `src/bot/dialogue_manager.py` —Å –∫–ª–∞—Å—Å–æ–º `DialogueManager`
- [x] In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: `dict` —Å `user_id ‚Üí [messages]`
- [x] –ú–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é
- [x] –ú–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (MAX_HISTORY_MESSAGES –∏–∑ .env)
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞: –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤ LLM

**–¢–µ—Å—Ç:** –í–µ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º - –æ–Ω –ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 4: –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
**–¶–µ–ª—å:** –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- [x] –ö–æ–º–∞–Ω–¥–∞ `/reset` - –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- [x] –ö–æ–º–∞–Ω–¥–∞ `/help` - —Å–ø—Ä–∞–≤–∫–∞ –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö
- [x] –£–ª—É—á—à–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ `/start` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

**–¢–µ—Å—Ç:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã: `/start`, `/reset`, `/help`

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 5: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–¶–µ–ª—å:** –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –ª–æ–≥–∞—Ö

- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `logging` –≤ `main.py`
- [x] –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª `bot.log` + –∫–æ–Ω—Å–æ–ª—å
- [x] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `TelegramBot`: –ø–æ–ª—É—á–µ–Ω–∏–µ/–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- [x] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `LLMClient`: –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã
- [x] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏ –≤ `DialogueManager`: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ (ERROR level)

**–¢–µ—Å—Ç:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `bot.log`

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 6: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç HomeGuru ‚úÖ
**–¶–µ–ª—å:** –†–æ–ª—å –ò–ò-–¥–∏–∑–∞–π–Ω–µ—Ä–∞ –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª —Å –ø—Ä–æ–º–ø—Ç–æ–º (TDD)

**TDD –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [x] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É: Config –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞, CommandHandler –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É `/role`
- [x] –ü–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤:
  - `test_config_loads_prompt_from_file()` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞
  - `test_config_prompt_file_not_found()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ñ–∞–π–ª–∞
  - `test_command_handler_get_role_message()` - –∫–æ–º–∞–Ω–¥–∞ `/role`
  - `test_start_message_with_homeguru_context()` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

**TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (RED-GREEN-REFACTOR):**

**–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:**
- [x] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_config_loads_prompt_from_file()`
- [x] üü¢ GREEN: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `src/bot/system_prompt.txt` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–æ–ª–∏ HomeGuru
- [x] üîµ REFACTOR: –û–±–Ω–æ–≤–∏—Ç—å `src/bot/config.py`: –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_load_system_prompt_from_file()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞
- [x] –û–ø–∏—Å–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é: –¥–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Å—Ç–∏–ª—è–º, –∞–Ω–∞–ª–∏–∑ –ø–æ–º–µ—â–µ–Ω–∏–π
- [x] –£–∫–∞–∑–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏: —Ü–≤–µ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è, –º–µ–±–µ–ª—å, –¥–µ–∫–æ—Ä
- [x] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:**
- [x] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_config_prompt_file_not_found()`
- [x] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `FileNotFoundError` –≤ Config
- [x] üîµ REFACTOR: Fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞
- [x] SYSTEM_PROMPT –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑ `.env` (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞)

**–ö–æ–º–∞–Ω–¥–∞ /role:**
- [x] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_command_handler_get_role_message()`
- [x] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_role_message()` –≤ `CommandHandler`
- [x] üîµ REFACTOR: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã `/role` –≤ `TelegramBot.cmd_role()`
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–æ–ª–∏ HomeGuru
- [x] –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
- [x] –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_help_message()` –≤ `CommandHandler` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ `/role`

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è:**
- [x] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_start_message_with_homeguru_context()`
- [x] üü¢ GREEN: –û–±–Ω–æ–≤–∏—Ç—å `get_start_message()` –≤ `CommandHandler` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç HomeGuru
- [x] üîµ REFACTOR: –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –¥–∏–∑–∞–π–Ω–µ –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:**
- [x] `make quality` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [x] Coverage: **98%** (–ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ 80%)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Ç–µ—Ä–∞—Ü–∏–∏ 6:**
- ‚úÖ Format: OK (ruff format, 0 –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ Lint: All checks passed (ruff check, 0 errors)
- ‚úÖ Typecheck: Success (mypy strict, 0 errors)
- ‚úÖ Tests: **34/34 passed** (7 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ Coverage: **98%**
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/system_prompt.txt` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–æ–ª–∏ HomeGuru
- ‚úÖ Config –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ —Å fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/role` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è `/start` –∏ `/help` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º HomeGuru

**–¢–µ—Å—Ç:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/role` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–æ–ª–∏ –ò–ò-–¥–∏–∑–∞–π–Ω–µ—Ä–∞. –û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–æ–ª–∏ HomeGuru.

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 7: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π ‚úÖ
**–¶–µ–ª—å:** –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Vision API (TDD + Protocol)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Ç–µ—Ä–∞—Ü–∏–∏ 7:**
- ‚úÖ Format: OK (ruff format, 0 –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ Lint: All checks passed (ruff check, 0 errors)
- ‚úÖ Typecheck: Success (mypy strict, 0 errors)
- ‚úÖ Tests: **53/53 passed** (19 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ Coverage: **98%** (–ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ 80%)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `MediaProvider` Protocol –≤ `interfaces.py`
- ‚úÖ –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `MediaProcessor` —Å –º–µ—Ç–æ–¥–∞–º–∏ `download_photo()` –∏ `photo_to_base64()`
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω `LLMProvider` Protocol –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `DialogueStorage` Protocol –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (content: `str | list[dict[str, Any]]`)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `DialogueManager` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `LLMClient` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Vision API —á–µ—Ä–µ–∑ OpenRouter
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `media_provider` –≤ `MessageHandler`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `MessageHandler.handle_photo_message()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `TelegramBot.handle_photo()` –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `main.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `MediaProcessor`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: `data:image/jpeg;base64,<base64_string>` (OpenAI Vision API format)
- –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: —Ç–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–º–µ—à–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é –∏ –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/bot/media_processor.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤
- `tests/test_media_processor.py` - 4 —Ç–µ—Å—Ç–∞ –¥–ª—è MediaProcessor
- `tests/test_message_handler.py` - 7 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è MessageHandler

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/bot/interfaces.py` - –¥–æ–±–∞–≤–ª–µ–Ω MediaProvider Protocol, –æ–±–Ω–æ–≤–ª–µ–Ω—ã LLMProvider –∏ DialogueStorage
- `src/bot/llm_client.py` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `src/bot/dialogue_manager.py` - –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `src/bot/message_handler.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- `src/bot/bot.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ handle_photo
- `src/bot/main.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MediaProcessor
- `tests/conftest.py` - —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è MediaProvider
- `tests/test_bot.py` - 4 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞ –¥–ª—è handle_photo
- `tests/test_llm_client.py` - 2 —Ç–µ—Å—Ç–∞ –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏
- `tests/test_dialogue_manager.py` - 2 —Ç–µ—Å—Ç–∞ –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏

**–¢–µ—Å—Ç:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É —Ñ–æ—Ç–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞ (—Å –ø–æ–¥–ø–∏—Å—å—é –∏–ª–∏ –±–µ–∑) - –ø–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç HomeGuru –ø–æ –¥–∏–∑–∞–π–Ω—É.

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 8: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ
**–¶–µ–ª—å:** –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Faster-Whisper (TDD + Protocol)

**TDD –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
  - –†–∞—Å—à–∏—Ä–∏—Ç—å `MediaProvider` Protocol –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ
  - –û–±–Ω–æ–≤–∏—Ç—å `MediaProcessor` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Faster-Whisper (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)
  - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ `MessageHandler` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ü–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤:
  - `test_media_processor_download_audio()` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ
  - `test_media_processor_transcribe_audio()` - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ Faster-Whisper
  - `test_message_handler_process_voice()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `test_transcription_error_handling()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (RED-GREEN-REFACTOR):**

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ MediaProvider Protocol:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_media_provider_audio_support()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ `MediaProvider` Protocol:
  ```python
  async def download_audio(self, file_id: str, bot: Bot) -> bytes: ...
  async def transcribe_audio(self, audio_bytes: bytes) -> str: ...
  ```
- [ ] üîµ REFACTOR: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

**Speech-to-Text —á–µ—Ä–µ–∑ Faster-Whisper (–ª–æ–∫–∞–ª—å–Ω–æ):**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_media_processor_transcribe_audio()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `faster-whisper` –≤ `pyproject.toml`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –≤ `MediaProcessor`
- [ ] üîµ REFACTOR: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Faster-Whisper (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å `base`)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Faster-Whisper –≤ `.env`: `WHISPER_MODEL=base`, `WHISPER_DEVICE=cpu`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `Config` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Whisper
- [ ] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π Telegram (OGG) –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Faster-Whisper
- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `MediaProcessor`

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ MessageHandler:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_message_handler_handle_voice_message()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `handle_voice_message(user_id, username, voice_file_id)` –≤ `MessageHandler`
- [ ] üîµ REFACTOR: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ MediaProvider ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç–∞

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ TelegramBot:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_bot_handle_voice()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ voice —Å–æ–æ–±—â–µ–Ω–∏–π –≤ `bot.py` - `async def handle_voice()`
- [ ] üîµ REFACTOR: –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `MessageHandler`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_transcription_error_handling()`
- [ ] üü¢ GREEN: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏/—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- [ ] üîµ REFACTOR: –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ Faster-Whisper

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_help_message_includes_voice_support()`
- [ ] üü¢ GREEN: –û–±–Ω–æ–≤–∏—Ç—å `/help` –≤ `CommandHandler` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (–ª–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ Faster-Whisper –º–æ–¥–µ–ª–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:**
- [ ] `make quality` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Coverage ‚â• 80%

**–¢–µ—Å—Ç:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º –æ –¥–∏–∑–∞–π–Ω–µ - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é Faster-Whisper base –º–æ–¥–µ–ª—å).

---

### –ò—Ç–µ—Ä–∞—Ü–∏—è 9: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ LangSmith
**–¶–µ–ª—å:** –¢—Ä–µ–π—Å–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ LLM (TDD)

**TDD –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
  - LangSmith –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã/–æ–±–µ—Ä—Ç–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è Protocol
  - –¢—Ä–µ–π—Å–∏–Ω–≥ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `LLMClient` –∏ `MessageHandler`
  - –ù–µ –Ω–∞—Ä—É—à–∞–µ–º SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- [ ] –ü–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤:
  - `test_config_langsmith_parameters()` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ LangSmith
  - `test_llm_client_with_tracing()` - —Ç—Ä–µ–π—Å–∏–Ω–≥ LLM –∑–∞–ø—Ä–æ—Å–æ–≤
  - `test_message_handler_with_tracing()` - —Ç—Ä–µ–π—Å–∏–Ω–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  - `test_tracing_metadata()` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ —Ç—Ä–µ–π—Å–∞—Ö

**TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (RED-GREEN-REFACTOR):**

**ADR –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [ ] –°–æ–∑–¥–∞—Ç—å ADR-02: –í—ã–±–æ—Ä LangSmith –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ LLM
- [ ] –û–±–æ—Å–Ω–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä LangSmith (—Ç—Ä–µ–π—Å–∏–Ω–≥, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, debugging)
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ LangSmith –∞–∫–∫–∞—É–Ω—Ç–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è API –∫–ª—é—á–∞

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LangSmith:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_config_langsmith_parameters()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `langsmith` –≤ `pyproject.toml`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`: `LANGSMITH_API_KEY`, `LANGSMITH_PROJECT`
- [ ] üü¢ GREEN: –û–±–Ω–æ–≤–∏—Ç—å `Config` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ LangSmith
- [ ] üîµ REFACTOR: –û–±–Ω–æ–≤–∏—Ç—å `.env.example`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ LLMClient:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_llm_client_traceable()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@traceable` –≤ `LLMClient.get_response()`
- [ ] üîµ REFACTOR: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–≥–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –∞—É–¥–∏–æ)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: model, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É

**–¢—Ä–µ–π—Å–∏–Ω–≥ MessageHandler (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_message_handler_traceable()`
- [ ] üü¢ GREEN: –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–π—Å–∏–Ω–≥ –¥–ª—è `MessageHandler.handle_user_message()`
- [ ] üîµ REFACTOR: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: user_id, —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ main.py:**
- [ ] üî¥ RED: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_langsmith_initialization()`
- [ ] üü¢ GREEN: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LangSmith –≤ `main.py` —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] üîµ REFACTOR: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞: "homeguru"

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ LangSmith
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ LangSmith

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
- [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–∑–Ω–æ–≥–æ —Ç–∏–ø–∞ (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –∞—É–¥–∏–æ)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–π—Å–æ–≤ –≤ LangSmith dashboard
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏: latency, token usage

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:**
- [ ] `make quality` - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Coverage ‚â• 80%

**–¢–µ—Å—Ç:** –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–æ—Ç–æ–º (—Ç–µ–∫—Å—Ç, —Ñ–æ—Ç–æ, –∞—É–¥–∏–æ) - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–µ–π—Å—ã –≤ LangSmith dashboard.

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ MVP

**–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–ò—Ç–µ—Ä–∞—Ü–∏–∏ 1-5):**
- ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram —á–µ—Ä–µ–∑ polling
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenRouter —á–µ—Ä–µ–∑ API
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ (in-memory)
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã: `/start`, `/reset`, `/help`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
- ‚úÖ –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**HomeGuru - –ò–ò-–¥–∏–∑–∞–π–Ω–µ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤ (–ò—Ç–µ—Ä–∞—Ü–∏–∏ 6-9):**
- [x] –†–æ–ª—å HomeGuru —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
- [x] –ö–æ–º–∞–Ω–¥–∞ `/role` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤ (Vision API)
- [ ] –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ª–æ–∫–∞–ª—å–Ω–∞—è Faster-Whisper base –º–æ–¥–µ–ª—å)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ LangSmith
- [ ] –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: —Ç–µ–∫—Å—Ç + —Ñ–æ—Ç–æ + –∞—É–¥–∏–æ
- [ ] ADR-02 —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º –≤—ã–±–æ—Ä–∞ LangSmith

---

## üìù –ó–∞–º–µ—Ç–∫–∏

**–û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–π —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **TDD –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω: —Ç–µ—Å—Ç—ã –ü–ï–†–ï–î –∫–æ–¥–æ–º** (RED-GREEN-REFACTOR)
- –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø–ª–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤
- –ö–æ–º–º–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è `make quality`
- –ï—Å–ª–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ - –æ—Ç–º–µ—Ç—å —Å—Ç–∞—Ç—É—Å ‚ùå –∏ –ø—Ä–∏—á–∏–Ω—É
- –í—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –∏–∑ [conventions.md](conventions.md) –∏ [workflow_tdd.mdc](.cursor/rules/workflow_tdd.mdc)

**–î–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–π 6-9 (HomeGuru):**
- –ò—Ç–µ—Ä–∞—Ü–∏–∏ 6-9 –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –µ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ò—Ç–µ—Ä–∞—Ü–∏—è 6 (—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç) - –±–∞–∑–æ–≤–∞—è, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π
- –ò—Ç–µ—Ä–∞—Ü–∏–∏ 7-8 (—Ñ–æ—Ç–æ/–∞—É–¥–∏–æ) –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ 6
- –ò—Ç–µ—Ä–∞—Ü–∏—è 9 (LangSmith) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–π, –∫–æ–≥–¥–∞ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã
- –ü—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Vision/Speech-to-Text —É—á–∏—Ç—ã–≤–∞–π —Å—Ç–æ–∏–º–æ—Å—Ç—å API –∑–∞–ø—Ä–æ—Å–æ–≤
- –¢–µ—Å—Ç–∏—Ä—É–π –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–π –∫–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–∞—Ö

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö 6-9:**
- –ò—Ç–µ—Ä–∞—Ü–∏—è 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `Config` –∏ `CommandHandler`
- –ò—Ç–µ—Ä–∞—Ü–∏—è 7: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `MediaProvider` Protocol –∏ `MediaProcessor` –∫–ª–∞—Å—Å–∞
- –ò—Ç–µ—Ä–∞—Ü–∏—è 7: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `LLMProvider` –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏
- –ò—Ç–µ—Ä–∞—Ü–∏—è 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `DialogueStorage` –¥–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏
- –ò—Ç–µ—Ä–∞—Ü–∏—è 8: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `MediaProvider` –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- –ò—Ç–µ—Ä–∞—Ü–∏—è 9: –¢—Ä–µ–π—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è Protocol

**TDD —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:**
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–ª–∞–Ω —Ç–µ—Å—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã?
- ‚úÖ –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –ü–ï–†–ï–î –∫–æ–¥–æ–º?
- ‚úÖ RED-GREEN-REFACTOR —Ü–∏–∫–ª—ã —Å–æ–±–ª—é–¥–µ–Ω—ã?
- ‚úÖ `make quality` –ø—Ä–æ—Ö–æ–¥–∏—Ç?
- ‚úÖ Coverage ‚â• 80%?
- ‚úÖ Protocol –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≥–¥–µ –Ω—É–∂–Ω–æ?

